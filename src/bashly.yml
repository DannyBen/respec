name: respec
help: RSpec Convenience Wrapper
version: 0.1.1

environment_variables:
- name: respec_status_file
  help: Where to store the rspec status file
  default: spec/status.txt

- name: respec_helper_path
  help: The location of the spec_helper.rb file
  default: spec/spec_helper.rb  

commands:
  - name: all
    alias: a
    help: Run full specs
    dependencies: &respec-deps
      rspec: Install using $(magenta gem install rspec)
      bundler: Install using $(magenta gem install bundler)

  - name: focus
    alias: f
    help: Run specs tagged with :focus
    dependencies: *respec-deps

  - name: only
    alias: o
    help: Run specs on files matching a pattern
    dependencies: *respec-deps
    args:
      - name: search
        help: Partial filename
        required: true

  - name: except
    alias: ex
    help: Run specs and exclude files matching a pattern
    dependencies: *respec-deps
    args:
      - name: search
        help: Partial filename
        required: true

  - name: last
    alias: l
    help: Run specs on files modified in the last N minutes
    dependencies: *respec-deps
    args:
      - name: min
        help: Number of minutes
        validate: integer
        default: "10"

  - name: fails
    alias: [failures]
    help: Run the last failed specs
    dependencies: *respec-deps
    filters: [spec_helper_config]

  - name: continue
    alias: [c, cont]
    help: Continue from where the last run stopped
    dependencies: *respec-deps
    filters: [spec_helper_config]

  - name: reset
    alias: r
    help: Delete the status file
    filters: [spec_helper_config]

  - name: watch
    alias: w
    help: Run specs marked with :focus when any *.rb file changes
    dependencies: 
      <<: *respec-deps
      filewatcher: Install with $(magenta gem install filewatcher-cli)

  - name: completions
    help: |
      Echo completions function

      Intended to be used with: eval "\$(respec completions)"
